- include: roles/docker/tasks/image-from-git.yml
  vars:
    task_name: le-gen container image
    name: le-gen
    tag: latest
    git_repo: https://github.com/jkoelndorfer/le-gen

- include: config.yml
  when: (state == 'present') or (state == 'started')

- include: roles/docker/tasks/container.yml
  vars:
    task_name: le-gen container
    name:  le-gen
    image: le-gen:latest
    published_ports:
      - "80:80"
    volumes:
      - "{{ container_config_directory }}/cert_renew.yml:/app/cert_renew.yml:ro"
      - "{{ container_data_directory }}/certs:/certs:rw"
    env:
      REDIRECT_URL: "{{ redirect_url }}"
